
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Development Guidelines &#8212; pytools  documentation</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/css/gamma.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/js/gamma.js"></script>
    <script src="_static/js/versions.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="FAQ" href="faqs.html" />
    <link rel="prev" title="pytools.viz.util.PercentageFormatter" href="apidoc/pytools/viz/util/pytools.viz.util.PercentageFormatter.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="index.html">
    
      <img src="_static/gamma_pytools_logo.png" class="logo" alt="logo" />
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="getting_started/getting_started.html">Getting started</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="apidoc/pytools.html">API reference</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="">Development Guidelines</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="faqs.html">FAQ</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
        
        
          
        
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#setup" class="nav-link">Setup</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#python-environment" class="nav-link">Python environment</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#pytest" class="nav-link">Pytest</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#git-guidelines" class="nav-link">Git Guidelines</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#documentation" class="nav-link">Documentation</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#docstrings" class="nav-link">Docstrings</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#sphinx-build" class="nav-link">Sphinx Build</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#readme" class="nav-link">README</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#package-builds" class="nav-link">Package builds</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#versioning" class="nav-link">Versioning</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#pypi" class="nav-link">PyPI</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#conda" class="nav-link">Conda</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#azure-devops-ci-cd" class="nav-link">Azure DevOps CI/CD</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#release-process" class="nav-link">Release process</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="development-guidelines">
<span id="contribution-guide"></span><h1>Development Guidelines<a class="headerlink" href="#development-guidelines" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<div class="section" id="python-environment">
<h3>Python environment<a class="headerlink" href="#python-environment" title="Permalink to this headline">¶</a></h3>
<p>There is an <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> provided in the repository root, which installs all
required development dependencies in the <code class="docutils literal notranslate"><span class="pre">pytools-develop</span></code> environment.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>conda env create -f environment.yml
conda activate pytools-develop
</pre></div>
</div>
<p>This command will:</p>
<ul class="simple">
<li><p>Install the conda environment</p></li>
<li><p>Install pre-commit hooks</p></li>
</ul>
</div>
<div class="section" id="pytest">
<h3>Pytest<a class="headerlink" href="#pytest" title="Permalink to this headline">¶</a></h3>
<p>Run <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">tests/</span></code> from the pytools root folder or use the PyCharm test runner. To
measure coverage, use <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">--cov=src/pytools</span> <span class="pre">tests/</span></code>. Note that the code coverage
reports are also generated in the Azure Pipelines (see CI/CD section).</p>
<p>Note that you will need to set the PYTHONPATH to the <code class="docutils literal notranslate"><span class="pre">src/</span></code> directory by
running <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">PYTHONPATH=./src/</span></code> from the repository root.</p>
</div>
</div>
<div class="section" id="git-guidelines">
<h2>Git Guidelines<a class="headerlink" href="#git-guidelines" title="Permalink to this headline">¶</a></h2>
<p>For commits to GitHub, phrase commit comments as the completion of the sentence <em>This
commit will …</em>, e.g.</p>
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>add method foo to class Bar
</pre></div>
</div>
<p>but not</p>
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>added method foo to class Bar
</pre></div>
</div>
</div>
<div class="section" id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h2>
<p>This section provides a general guide to the documentation of <em>pytools</em>, including
docstrings, Sphinx, the README and tutorial notebooks.</p>
<div class="section" id="docstrings">
<h3>Docstrings<a class="headerlink" href="#docstrings" title="Permalink to this headline">¶</a></h3>
<p>The API documentation is generated from docstrings in the source code. Before writing
your own, take some time to study the existing code documentation and emulate the same
style. Describe not only what the code does, but also why, including the rationale for
any design choices that may not be obvious. Provide examples wherever this helps
explain usage patterns.</p>
<ul>
<li><p>A docstring is mandatory for all of the following entities in the source code,
except when they are protected/private (i.e. the name starts with a leading <cite>_</cite>
character):</p>
<ul class="simple">
<li><p>modules</p></li>
<li><p>classes</p></li>
<li><p>functions/methods</p></li>
<li><p>properties</p></li>
<li><p>attributes</p></li>
</ul>
</li>
<li><p>Docstrings are not necessary for non-public methods, but you should have a comment
that describes what the method does.</p></li>
<li><p>Docstrings must use <em>reStructuredText</em> syntax, the default syntax for Sphinx.</p></li>
<li><p>Write docstrings for functions and methods in the imperative style, e.g.,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fit</span><span class="p">():</span>
<span class="sd">&quot;&quot;&quot;Fit the model.&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>but not</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fit</span><span class="p">():</span>
<span class="sd">&quot;&quot;&quot;This is a function that fits the model.&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>which is too wordy and not imperative.</p>
</li>
<li><p>Write docstrings for modules, classes, modules, and attributes starting with a
descriptive phrase (as you would expect in a dictionary entry). Be concise and avoid
unnecessary or redundant phrases.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Inspector</span><span class="p">:</span>
    <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Explains the inner workings of a predictive model using the SHAP approach.</span>

<span class="s2">    The inspector offers the following analyses:</span>
<span class="s2">    - ...</span>
<span class="s2">    - ...</span>
</pre></div>
</div>
<p>but not</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Inspector</span><span class="p">:</span>
    <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    This is a class that provides the functionality to inspect models</span>
<span class="s2">    ...</span>
</pre></div>
</div>
<p>as this is too verbose, and explains the class in terms of its name which does not add
any information.</p>
</li>
<li><p>Properties should be documented as if they were attributes, not as methods, e.g.,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Foo</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;The child nodes of the tree&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>but not</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Foo</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;:return: the foo object&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
</li>
<li><p>Start full sentences and phrases with a capitalised word and end each sentence with
punctuation, e.g.,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Fit the model.&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>but not</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;fit the model&quot;&quot;&quot;</span>
</pre></div>
</div>
</li>
<li><p>For multi-line docstrings, insert a line break after the leading triple quote and before
the trailing triple quote, e.g.,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fit</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fit the model.</span>

<span class="sd">    Use the underlying estimator&#39;s ``fit`` method</span>
<span class="sd">    to fit the model using the given training sample.</span>

<span class="sd">    :param sample: training sample</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>but not</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fit</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Fit the model.</span>

<span class="sd">    Use the underlying estimator&#39;s ``fit`` method</span>
<span class="sd">    to fit the model using the given training sample.</span>

<span class="sd">    :param sample: training sample&quot;&quot;&quot;</span>
</pre></div>
</div>
</li>
<li><p>For method arguments, return value, and class parameters, one must hint the type using
the typing module. Do not specify the parameter types in the docstrings, e.g.,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
   <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">   Do something.</span>

<span class="s2">   :param x: input value</span>
<span class="s2">   :return: output value</span>
</pre></div>
</div>
<p>but not</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
   <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">   Do something.</span>

<span class="s2">   :param int x: input value</span>
<span class="s2">   :return float: output value</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="sphinx-build">
<h3>Sphinx Build<a class="headerlink" href="#sphinx-build" title="Permalink to this headline">¶</a></h3>
<p>Documentation for <em>pytools</em> is built using <a class="reference external" href="https://www.sphinx-doc.org/en/master/">sphinx</a>.
Before building the documentation ensure the <code class="docutils literal notranslate"><span class="pre">pytools-develop</span></code> environment is active as
the documentation build has a number of key dependencies specified in the
<code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> file, specifically:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sphinx</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pydata-sphinx-theme</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nbsphinx</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sphinx-autodoc-typehints</span></code></p></li>
</ul>
<p>To generate the Sphinx documentation locally navigate to <code class="docutils literal notranslate"><span class="pre">/sphinx</span></code> and run</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python make.py html
</pre></div>
</div>
<p>By default this will clean any previous build. The generated Sphinx
documentation for <em>pytools</em> can then be found at <code class="docutils literal notranslate"><span class="pre">sphinx/build/html</span></code>.</p>
<p>Documentation versioning is managed via the release process - see the section on
building and releasing <em>pytools</em> below.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">sphinx</span></code> folder in the root directory contains the following:</p>
<ul class="simple">
<li><p>a <code class="docutils literal notranslate"><span class="pre">make.py</span></code> script for executing the documentation build via python.</p></li>
<li><p>a <code class="docutils literal notranslate"><span class="pre">source</span></code> directory containing predefined .rst files for the documentation build and other required elements, see below for more details.</p></li>
<li><p>a <code class="docutils literal notranslate"><span class="pre">base</span></code> folder which contains the <code class="docutils literal notranslate"><span class="pre">make_base.py</span></code> and <code class="docutils literal notranslate"><span class="pre">conf_base.py</span></code> scripts which contain nearly all configuration for <code class="docutils literal notranslate"><span class="pre">make.py</span></code> and <code class="docutils literal notranslate"><span class="pre">conf.py</span></code>.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">sphinx/source</span></code> folder contains:</p>
<ul>
<li><p>a <code class="docutils literal notranslate"><span class="pre">conf.py</span></code> script that is the <a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/configuration.html">build configuration file</a> needed to customize the input and output behavior of the Sphinx documentation build (see below for further details).</p></li>
<li><p>the base .rst files used for the documentation build, which are:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">index.rst</span></code>: definition of the high-level documentation structure which mainly references the other rst files in this directory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">contribution_guide.rst</span></code>: detailed information on building and releasing <em>pytools</em>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">faqs.rst</span></code>: contains guidance on bug reports/feature requests, how to contribute and answers to frequently asked questions including small code snippets.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">api_landing.rst</span></code>: for placing any API landing page preamble for documentation as needed. This information will appear on the API landing page in the documentation build after the short description in <code class="docutils literal notranslate"><span class="pre">src/__init__.py</span></code>. This file is included in the documentation build via the <code class="docutils literal notranslate"><span class="pre">custom-module-template.rst</span></code>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">_static</span></code> contains additional material used in the documentation build, in this case, logos and icons.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_static_base</span></code> contains logos, icons, javascript and css used for <em>pytools</em> and other packages documentation builds.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_templates</span></code> contains the <code class="docutils literal notranslate"><span class="pre">autosummary.rst</span></code> which relies on the <code class="docutils literal notranslate"><span class="pre">custom-module-template.rst</span></code> from <code class="docutils literal notranslate"><span class="pre">pytools/tree/develop/sphinx/source/_templates</span></code> which is used in generating/formatting the modules and classes for the API documentation.</p></li>
</ul>
<p>The two key scripts are <code class="docutils literal notranslate"><span class="pre">make.py</span></code> and <code class="docutils literal notranslate"><span class="pre">conf.py</span></code>. The base configuration for the
these scripts can be found in <a class="reference external" href="https://github.com/BCG-Gamma/pytools/tree/develop/sphinx">pytools/sphinx</a>.
The reason for this was to minimise code given the standardization of the documentation
build across multiple packages.</p>
<p><strong>make.py</strong>: All base configuration comes from <code class="docutils literal notranslate"><span class="pre">pytools/sphinx/base/make_base.py</span></code> and
this script includes defined commands for key steps in the documentation build. Briefly,
the key steps for the documentation build are:</p>
<ul class="simple">
<li><p><strong>Clean</strong>: remove the existing documentation build</p></li>
<li><p><strong>FetchPkgVersions</strong>: fetch the available package versions with documentation</p></li>
<li><p><strong>ApiDoc</strong>: generate API documentation from sources</p></li>
<li><p><strong>Html</strong>: run Sphinx build to generate HTMl documentation</p></li>
</ul>
<p>The two other commands are <strong>Help</strong> and <strong>PrepareDocsDeployment</strong>, the latter of which
is covered below under building and releasing <em>pytools</em>.</p>
<p><strong>conf.py</strong>: All base configuration comes from <code class="docutils literal notranslate"><span class="pre">pytools/sphinx/base/conf_base.py</span></code>. This
<a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/configuration.html">build configuration file</a>
is a requirement of Sphinx and is needed to customize the input and output behavior of
the documentation build. In particular, this file highlights key extensions needed in
the build process, of which some key ones are as follows:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/extensions/intersphinx.html">intersphinx</a> (external links to other documentations built with Sphinx: scikit-learn, numpy…)</p></li>
<li><p><a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/extensions/viewcode.html">viewcode</a> to include source code in the documentation, and links to the source code from the objects documentation</p></li>
<li><p><a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/extensions/math.html">imgmath</a> to render math expressions in doc strings. Note that a local latex installation is required (e.g., <a class="reference external" href="https://miktex.org/">MiKTeX</a> for Windows)</p></li>
</ul>
</div>
<div class="section" id="readme">
<h3>README<a class="headerlink" href="#readme" title="Permalink to this headline">¶</a></h3>
<p>The README file for the repo is .rst format instead of the perhaps more traditional
markdown format. The reason for this is the <code class="docutils literal notranslate"><span class="pre">README.rst</span></code> is included as the quick start
guide in the documentation build. This helped minimize code duplication. However,
there are a few key points to be aware of:</p>
<ul class="simple">
<li><p>The README has links to logos and icons located in the <code class="docutils literal notranslate"><span class="pre">sphinx/source/_static</span></code> folder.
To ensure these links are correct when the documentation is built, they are altered and then the
contents of the <code class="docutils literal notranslate"><span class="pre">README.rst</span></code> is incorporated into the <code class="docutils literal notranslate"><span class="pre">getting_started.rst</span></code> which is generated
during the build and can be found in <code class="docutils literal notranslate"><span class="pre">sphinx/source/getting_started</span></code>.</p></li>
</ul>
</div>
</div>
<div class="section" id="package-builds">
<h2>Package builds<a class="headerlink" href="#package-builds" title="Permalink to this headline">¶</a></h2>
<p>The build process for the PyPI and conda distributions uses the following key
files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">make.py</span></code>: generic Python script for package builds. Most configuration is imported
from pytools <a class="reference external" href="https://github.com/BCG-Gamma/pytools/blob/develop/make.py">make.py</a>
which is a build script that wraps the package build, as well as exposing the matrix
dependency definitions specified in the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> as environment variables</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>: metadata for PyPI, build settings and package dependencies</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tox.ini</span></code>: contains configurations for tox, testenv, flake8, isort, coverage report,
and pytest</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">condabuild/meta.yml</span></code>: metadata for conda, build settings and package dependencies</p></li>
</ul>
<div class="section" id="versioning">
<h3>Versioning<a class="headerlink" href="#versioning" title="Permalink to this headline">¶</a></h3>
<p><em>pytools</em> version numbering follows the <a class="reference external" href="https://semver.org/">semantic versioning</a>
approach, with the pattern <code class="docutils literal notranslate"><span class="pre">MAJOR.MINOR.PATCH</span></code>.
The version can be bumped in the <code class="docutils literal notranslate"><span class="pre">src/__init__.py</span></code> by updating the
<code class="docutils literal notranslate"><span class="pre">__version__</span></code> string accordingly.</p>
</div>
<div class="section" id="pypi">
<h3>PyPI<a class="headerlink" href="#pypi" title="Permalink to this headline">¶</a></h3>
<p>PyPI project metadata, build settings and package dependencies
are obtained from <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>. To build and then publish the package to PyPI,
use the following commands:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python make.py gamma-pytools tox default
flit publish
</pre></div>
</div>
<p>Please note the following:</p>
<ul>
<li><p>Because the PyPI package index is immutable, it is recommended to do a test
upload to <a class="reference external" href="https://test.pypi.org/">PyPI test</a> first. Ensure all metadata presents
correctly before proceeding to proper publishing. The command to publish to test is</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>flit publish --repository testpypi
</pre></div>
</div>
<p>which requires the specification of testpypi in a special <code class="docutils literal notranslate"><span class="pre">.pypirc</span></code> file
with specifications as demonstrated <a class="reference external" href="https://flit.readthedocs.io/en/latest/upload.html">here</a>.</p>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> does not provide specification for a short description
(displayed in the top gray band on the PyPI page for the package). This description
comes from the <code class="docutils literal notranslate"><span class="pre">src/__init__.py</span></code> script.</p></li>
<li><p><a class="reference external" href="https://flit.readthedocs.io/en/latest/">flit</a> which is used here to publish to
PyPI, also has the flexibility to support package building (wheel/sdist) via
<code class="docutils literal notranslate"><span class="pre">flit</span> <span class="pre">build</span></code> and installing the package by copy or symlink via <code class="docutils literal notranslate"><span class="pre">flit</span> <span class="pre">install</span></code>.</p></li>
<li><p>Build output will be stored in the <code class="docutils literal notranslate"><span class="pre">dist/</span></code> directory.</p></li>
</ul>
</div>
<div class="section" id="conda">
<h3>Conda<a class="headerlink" href="#conda" title="Permalink to this headline">¶</a></h3>
<p>conda build metadata, build settings and package dependencies
are obtained from <code class="docutils literal notranslate"><span class="pre">meta.yml</span></code>. To build and then publish the package to conda,
use the following commands:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python make.py gamma-pytools conda default
anaconda upload --user BCG_Gamma dist/conda/noarch/&lt;*package.tar.gz*&gt;
</pre></div>
</div>
<p>Please note the following:</p>
<ul>
<li><p>Build output will be stored in the <code class="docutils literal notranslate"><span class="pre">dist/</span></code> directory.</p></li>
<li><p>Some useful references for conda builds:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://docs.conda.io/projects/conda-build/en/latest/user-guide/tutorials/building-conda-packages.html">Conda build tutorial</a></p></li>
<li><p><a class="reference external" href="https://docs.conda.io/projects/conda-build/en/latest/resources/define-metadata.html">Conda build metadata reference</a></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="azure-devops-ci-cd">
<h2>Azure DevOps CI/CD<a class="headerlink" href="#azure-devops-ci-cd" title="Permalink to this headline">¶</a></h2>
<p>This project uses <a class="reference external" href="https://dev.azure.com/">Azure DevOps</a> for CI/CD pipelines.
The pipelines are defined in the <code class="docutils literal notranslate"><span class="pre">azure-pipelines.yml</span></code> file and are divided into
the following stages:</p>
<ul class="simple">
<li><p><strong>code_quality_checks</strong>: perform code quality checks for isort, black and flake8.</p></li>
<li><p><strong>detect_build_config_changes</strong>: detect whether the build configuration as specified
in the <code class="docutils literal notranslate"><span class="pre">pyproject.yml</span></code> has been modified. If it has, then a build test is run.</p></li>
<li><p><strong>Unit tests</strong>: runs all unit tests and then publishes test results and coverage.</p></li>
<li><p><strong>conda_tox_build</strong>: build the PyPI and conda distribution artifacts.</p></li>
<li><p><strong>Release</strong>: see release process below for more detail.</p></li>
<li><p><strong>Docs</strong>: build and publish documentation to GitHub Pages.</p></li>
</ul>
<div class="section" id="release-process">
<h3>Release process<a class="headerlink" href="#release-process" title="Permalink to this headline">¶</a></h3>
<p>Before initiating the release process, please ensure the version number
in <code class="docutils literal notranslate"><span class="pre">src/__init__.py</span></code> is correct and the format conforms to semantic
versioning. If the version needs to be corrected/bumped then open a PR for the
change and merge into develop before going any further.</p>
<p>The release process has the following key steps:</p>
<ul class="simple">
<li><p>Create a new release branch from develop and open a PR to master</p></li>
<li><p>Opening the PR to master will automatically run all conda/pip build tests via
Azure Pipelines, triggering automatic upload of artifacts (conda and pip
packages) to Azure DevOps. At this stage, it is recommended that the pip package
build is checked using <a class="reference external" href="https://test.pypi.org/">PyPI test</a> to ensure all
metadata presents correctly. This is important as package versions in
PyPI proper are immutable</p></li>
<li><p>If everything passes and looks okay, merge the PR into master, this will
trigger the release pipeline which will:</p>
<ul>
<li><p>Tag the release commit with version number as specified in <code class="docutils literal notranslate"><span class="pre">src/__init__.py</span></code></p></li>
<li><p>Create a release on GitHub for the new version, please check the <a class="reference external" href="https://docs.github.com/en/free-pro-team&#64;latest/github/administering-a-repository/releasing-projects-on-github">documentation</a>
for details</p></li>
<li><p>Pre-fill the GitHub release title and description, including the changelog based on
commits since the last release. Please note this can be manually edited to be more
succinct afterwards</p></li>
<li><p>Attach build artifacts (conda and pip packages) to GitHub release</p></li>
</ul>
</li>
<li><p>Manually upload build artifacts to conda/PyPI using <code class="docutils literal notranslate"><span class="pre">anaconda</span> <span class="pre">upload</span></code> and
<code class="docutils literal notranslate"><span class="pre">flit</span> <span class="pre">publish</span></code>, respectively (see relevant sections under Package builds above)
This may be automated in the future</p></li>
<li><p>Remove any test versions for pip from PyPI test</p></li>
<li><p>Merge any changes from release branch also back to develop</p></li>
<li><p>Bump up version in <code class="docutils literal notranslate"><span class="pre">src/__init__.py</span></code> on develop to start work towards next release</p></li>
</ul>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="apidoc/pytools/viz/util/pytools.viz.util.PercentageFormatter.html" title="previous page">pytools.viz.util.PercentageFormatter</a>
    <a class='right-next' id="next-link" href="faqs.html" title="next page">FAQ</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2020, Boston Consulting Group (BCG).<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>